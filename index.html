<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeGroup - Kavler_Kevlar</title>
    <!-- PWA Kapcsolat -->
    <link rel="manifest" href="manifest2.json">
    <meta name="theme-color" content="#5865f2">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; background: #23272a; color: white; padding: 20px; margin: 0; }
        .container { background: #2c2f33; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 400px; margin: 40px auto; }
        h1 { color: #5865f2; margin-bottom: 5px; }
        .user-tag { background: #5865f2; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .btn { background: #57f287; border: none; padding: 20px 40px; color: black; font-weight: bold; border-radius: 12px; cursor: pointer; font-size: 18px; margin-top: 30px; width: 100%; transition: 0.3s; }
        .btn:active { transform: scale(0.95); background: #3ba55c; }
        #status { margin-top: 25px; font-size: 16px; color: #b9bbbe; min-height: 50px; line-height: 1.5; }
        .footer-note { font-size: 11px; color: #72767d; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üõ°Ô∏è SafeGroup</h1>
        <span class="user-tag">Kavler_Kevlar</span>
        
        <button class="btn" onclick="startTracking()">K√ñVET√âS IND√çT√ÅSA</button>
        
        <div id="status">V√°rakoz√°s az ind√≠t√°sra...</div>
        
        <p class="footer-note">A kijelz≈ët ne z√°rd le! Samsung A15-√∂n hagyd az appot az el≈ët√©rben.</p>
    </div>

    <script>
        // WEBHOOK KONFIGUR√ÅCI√ì
        const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1462078788853698712/9m8atZ32hIGG_KKFyKsr_7ZKslgPMtPDzLC5ZrZhuyj-Dybh3ZJb_-yi45Z9VebGrCDD";
       let wakeLock = null;
       let currentUserName = ""; // Itt t√°roljuk majd a megadott nevet

       async function startTracking() {
       // 1. N√©v bek√©r√©se ind√≠t√°skor
       currentUserName = prompt("K√©rlek, add meg a neved a k√∂vet√©shez:", "Bar√°t");
    
       // Ha m√©gsem √≠r be semmit, adunk neki egy alapnevet
       if (currentUserName === null || currentUserName === "") {
           currentUserName = "Ismeretlen Felhaszn√°l√≥";
       }

       const statusDiv = document.getElementById("status");
       statusDiv.innerHTML = `‚è≥ <b>${currentUserName}</b>, kapcsol√≥d√°s a m≈±holdakhoz...`;

       // 2. K√©perny≈ë √©brentart√°sa (WakeLock)
       if ('wakeLock' in navigator) {
           try {
               wakeLock = await navigator.wakeLock.request('screen');
           } catch (err) {
               console.error(`${err.name}, ${err.message}`);
           }
       }

       // 3. GPS ind√≠t√°sa
       if (navigator.geolocation) {
           navigator.geolocation.watchPosition(sendLocation, handleError, {
               enableHighAccuracy: true,
               maximumAge: 0,
               timeout: 30000
            });
            statusDiv.innerHTML = `üî¥ <b>${currentUserName}</b> k√∂vet√©se akt√≠v!`;
        } else {
            statusDiv.innerHTML = "‚ùå Hiba: A GPS nem t√°mogatott.";
        }
    }

    function sendLocation(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const accuracy = Math.round(position.coords.accuracy);
        const googleLink = `https://www.google.com{lat},${lon}`;

        const payload = {
            embeds: [{
                 title: `üöÄ ${currentUserName} mozg√°sban van`, // A bek√©rt nevet haszn√°lja
                 color: 5814783,
                 description: `üìç [Kattints ide a t√©rk√©p megnyit√°s√°hoz](${googleLink})`,
                 fields: [
                     { name: "Koordin√°t√°k", value: `\`${lat.toFixed(6)}, ${lon.toFixed(6)}\``, inline: true },
                     { name: "Pontoss√°g", value: `\`${accuracy} m√©ter\``, inline: true }
                 ],
                 footer: { text: "SafeGroup 2026 ‚Ä¢ " + new Date().toLocaleTimeString() },
                 timestamp: new Date().toISOString()
             }]
         };

        fetch(DISCORD_WEBHOOK, {
             method: "POST",
             headers: { "Content-Type": "application/json" },
             body: JSON.stringify(payload)
         }).then(() => {
             document.getElementById("status").innerHTML = `‚úÖ Friss√≠tve (${currentUserName})<br>Id≈ë: ` + new Date().toLocaleTimeString();
         })

            .then(() => {
                document.getElementById("status").innerHTML = "‚úÖ Sikeres friss√≠t√©s!<br>Id≈ë: " + new Date().toLocaleTimeString();
            })
            .catch(err => {
                console.error("Discord hiba:", err);
            });
        }

        function handleError(err) {
            let msg = "GPS hiba: ";
            if (err.code === 1) msg += "Enged√©ly megtagadva!";
            else if (err.code === 2) msg += "Jelkeres√©s (menj ablakhoz)...";
            else if (err.code === 3) msg += "Id≈ët√∫ll√©p√©s.";
            
            document.getElementById("status").innerHTML = `<span style="color: #f04747;">${msg}</span>`;
            console.warn(msg, err);
        }
    </script>
</body>

</html>

